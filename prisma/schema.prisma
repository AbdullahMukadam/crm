generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String     @id @default(cuid())
  username        String     @unique
  email           String     @unique
  password        String
  avatarUrl       String?
  createdAt       DateTime   @default(now())
  onboarded       Boolean    @default(false)
  role            Role?
  updatedAt       DateTime   @default(now()) @updatedAt
  invoices        Invoice[]
  leads           Lead[]
  clientProjects  Project[]  @relation("ClientProjects")
  createdProjects Project[]  @relation("CreatorProjects")
  proposals       Proposal[]
  team            Team[]     @relation("TeamToUser")
}

model Team {
  id        String       @id @default(cuid())
  name      String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  members   TeamMember[] @relation("TeamToTeamMember")
  User      User[]       @relation("TeamToUser")
}

model TeamMember {
  id     String @id @default(cuid())
  userId String
  teamId String
  role   Role   @default(CREATOR)
  Team   Team[] @relation("TeamToTeamMember")
}

model Project {
  id           String        @id @default(cuid())
  title        String
  description  String?
  status       ProjectStatus @default(PLANNING)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  creatorId    String
  clientId     String
  proposalId   String?       @unique
  deliverables Deliverable[]
  invoices     Invoice[]
  client       User          @relation("ClientProjects", fields: [clientId], references: [id])
  creator      User          @relation("CreatorProjects", fields: [creatorId], references: [id])
  proposal     Proposal?     @relation(fields: [proposalId], references: [id])
}

model Proposal {
  id        String         @id @default(cuid())
  title     String
  status    ProposalStatus @default(DRAFT)
  amount    Decimal?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  creatorId String
  clientId  String?
  content   Json?          @default("[]")
  project   Project?
  creator   User           @relation(fields: [creatorId], references: [id])
}

model Deliverable {
  id          String            @id @default(cuid())
  title       String
  description String?
  linkUrl     String?
  fileUrl     String?
  status      DeliverableStatus @default(PENDING_REVIEW)
  submittedAt DateTime          @default(now())
  projectId   String
  project     Project           @relation(fields: [projectId], references: [id])
}

model Invoice {
  id            String        @id @default(cuid())
  invoiceNumber String        @unique
  amount        Decimal
  dueDate       DateTime
  paidAt        DateTime?
  status        InvoiceStatus @default(DRAFT)
  createdAt     DateTime      @default(now())
  clientId      String
  projectId     String
  client        User          @relation(fields: [clientId], references: [id])
  project       Project       @relation(fields: [projectId], references: [id])
}

model Lead {
  id           String   @id @default(cuid())
  name         String
  email        String
  companyName  String?
  mobileNumber String?
  note         String?
  userId       String?
  status       String   @default("new-lead")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  User         User?    @relation(fields: [userId], references: [id])
}

model FormVisit {
  id         String   @id @default(cuid())
  username   String   
  deviceType String   
  visitDate  DateTime @default(now())
  createdAt  DateTime @default(now())
  
  @@index([username, visitDate])
  @@index([username, deviceType])
}

model Branding {
  id         String   @id @default(cuid())
  formFeilds Json
  creatorId  String
  username   String   @default("")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

enum Role {
  CLIENT
  CREATOR
  ADMIN
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  COMPLETED
  CANCELED
}

enum ProposalStatus {
  DRAFT
  SENT
  ACCEPTED
  DECLINED
}

enum DeliverableStatus {
  PENDING_REVIEW
  REVISIONS_REQUESTED
  APPROVED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
}
